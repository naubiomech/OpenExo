<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Adding New Sensors &#8212; OpenExo Documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
    <link rel="stylesheet" type="text/css" href="_static/basic_mod.css?v=9b2032db" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=0ac4fbd8" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <script src="_static/js/petite-vue.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Adding New UART Messages" href="AddingNewUARTMessage.html" />
    <link rel="prev" title="Adding a New Motor Type" href="AddingNewMotorType.html" /> 
  </head><body data-dark_mode_code_blocks="true">

<div id="top_nav">
    

    <nav>
        
            
        

        <p id="toggle_sidebar">
            <a href="#" title="Toggle sidebar">|||</a>
        </p>
        <h1><a href="index.html" title="Go to homepage">OpenExo</a></h1>

        <a id="mode_toggle" href="#" @click.prevent="handleClick" :title="mode">
    <template v-if="mode == 'light'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_light"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M67.48,18.073c1.913,-1.912 1.913,-5.018 0,-6.931c-1.912,-1.912 -5.018,-1.912 -6.931,0l-6.798,6.799c-1.912,1.912 -1.912,5.018 0,6.931c1.913,1.912 5.018,1.912 6.931,-0l6.798,-6.799Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.728,61.108c1.912,-1.913 1.912,-5.018 -0,-6.931c-1.913,-1.913 -5.019,-1.913 -6.931,-0l-6.799,6.798c-1.912,1.913 -1.912,5.019 0,6.931c1.913,1.913 5.019,1.913 6.931,0l6.799,-6.798Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.682,54.177c-1.913,-1.913 -5.018,-1.913 -6.931,-0c-1.912,1.913 -1.912,5.018 0,6.931l6.798,6.798c1.913,1.913 5.019,1.913 6.931,0c1.913,-1.912 1.913,-5.018 0,-6.931l-6.798,-6.798Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M4.901,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901l-0,9.614c-0,2.705 2.196,4.901 4.9,4.901c2.705,-0 4.901,-2.196 4.901,-4.901l0,-9.614Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M18.929,11.142c-1.912,-1.912 -5.018,-1.912 -6.931,0c-1.912,1.913 -1.912,5.019 0,6.931l6.799,6.799c1.912,1.912 5.018,1.912 6.931,-0c1.912,-1.913 1.912,-5.019 -0,-6.931l-6.799,-6.799Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.108,34.623c-2.705,0 -4.901,2.196 -4.901,4.901c-0,2.705 2.196,4.901 4.901,4.901l9.614,0c2.705,0 4.901,-2.196 4.901,-4.901c-0,-2.705 -2.196,-4.901 -4.901,-4.901l-9.614,0Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'dark'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_dark"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><circle cx="39.311" cy="39.524" r="15.734" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.212,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.901,2.196 -4.901,4.901c0,2.705 2.197,4.901 4.901,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.662,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.989,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.732,61.103c1.91,-1.91 1.91,-5.011 0,-6.921l-0.009,-0.01c-1.91,-1.91 -5.012,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.909,1.91 5.011,1.91 6.92,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.672,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.52,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l-0,-0.01c-0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.212,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.901,2.196 -4.901,4.901c0,2.704 2.197,4.9 4.901,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.73,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 -0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.098,34.623c-2.699,0 -4.891,2.192 -4.891,4.892l-0,0.019c-0,2.699 2.192,4.891 4.891,4.891c2.7,0 4.892,-2.192 4.892,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.892,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>

    <template v-if="mode == 'darkest'">
        <svg width="100%" height="100%" viewBox="0 0 79 80" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;"><g id="mode_darkest"><rect id="Bounds" x="0" y="-0" width="78.623" height="79.049" style="fill:none;"/><path d="M39.315,23.791c8.684,-0 15.734,7.05 15.734,15.733c0,8.684 -7.05,15.734 -15.734,15.734c-8.683,0 -15.733,-7.05 -15.733,-15.734c-0,-8.683 7.05,-15.733 15.733,-15.733Zm0,4.737c6.069,0 10.997,4.927 10.997,10.996c-0,6.069 -4.928,10.996 -10.997,10.996c-6.068,0 -10.996,-4.927 -10.996,-10.996c0,-6.069 4.928,-10.996 10.996,-10.996Z" style="fill:#fff;"/><g id="beams"><g id="beam"><path id="beam1" serif:id="beam" d="M44.216,14.515c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,0 -4.9,2.196 -4.9,4.901c-0,2.705 2.196,4.901 4.9,4.901c2.705,0 4.901,-2.196 4.901,-4.901Z" style="fill:#fff;"/></g><g id="beam2" serif:id="beam"><path id="beam3" serif:id="beam" d="M60.666,24.892c1.902,-1.902 1.902,-4.99 0,-6.892l-0.04,-0.039c-1.901,-1.902 -4.989,-1.902 -6.891,-0c-1.901,1.901 -1.901,4.989 0,6.891l0.04,0.04c1.902,1.901 4.99,1.901 6.891,-0Z" style="fill:#fff;"/></g><g id="beam4" serif:id="beam"><path id="beam5" serif:id="beam" d="M25.737,61.103c1.909,-1.91 1.909,-5.011 -0,-6.921l-0.01,-0.01c-1.91,-1.91 -5.011,-1.91 -6.921,-0c-1.91,1.91 -1.91,5.011 -0,6.921l0.01,0.01c1.91,1.91 5.011,1.91 6.921,-0Z" style="fill:#fff;"/></g><g id="beam6" serif:id="beam"><path id="beam7" serif:id="beam" d="M60.676,54.167c-1.907,-1.907 -5.004,-1.907 -6.911,0l-0.02,0.02c-1.907,1.907 -1.907,5.004 0,6.911c1.907,1.907 5.004,1.907 6.911,-0l0.02,-0.02c1.907,-1.907 1.907,-5.004 0,-6.911Z" style="fill:#fff;"/></g><g id="beam8" serif:id="beam"><path id="beam9" serif:id="beam" d="M14.524,34.623c-2.702,0 -4.896,2.194 -4.896,4.896l0,0.01c0,2.702 2.194,4.896 4.896,4.896c2.702,0 4.896,-2.194 4.896,-4.896l0,-0.01c0,-2.702 -2.194,-4.896 -4.896,-4.896Z" style="fill:#fff;"/></g><g id="beam10" serif:id="beam"><path id="beam11" serif:id="beam" d="M44.216,64.534c0,-2.705 -2.196,-4.901 -4.901,-4.901c-2.704,-0 -4.9,2.196 -4.9,4.901c-0,2.704 2.196,4.9 4.9,4.9c2.705,0 4.901,-2.196 4.901,-4.9Z" style="fill:#fff;"/></g><g id="beam12" serif:id="beam"><path id="beam13" serif:id="beam" d="M25.734,17.943c-1.911,-1.911 -5.015,-1.911 -6.926,0l-0.005,0.005c-1.911,1.911 -1.911,5.015 0,6.926c1.911,1.911 5.015,1.911 6.926,0l0.005,-0.005c1.911,-1.911 1.911,-5.014 0,-6.926Z" style="fill:#fff;"/></g><g id="beam14" serif:id="beam"><path id="beam15" serif:id="beam" d="M64.103,34.623c-2.7,0 -4.892,2.192 -4.892,4.892l-0,0.019c-0,2.699 2.192,4.891 4.892,4.891c2.699,0 4.891,-2.192 4.891,-4.891l0,-0.019c0,-2.7 -2.192,-4.892 -4.891,-4.892Z" style="fill:#fff;"/></g></g></g></svg>
    </template>
</a>

<script>
(function() {
    const LOCAL_STORAGE_KEY = 'piccoloThemeMode'

    var initialMode = localStorage.getItem(LOCAL_STORAGE_KEY)

    if (initialMode) {
        // Make sure the value in local storage is valid
        if (['light', 'dark', 'darkest'].indexOf(initialMode) == -1) {
            initialMode = 'light'
            localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
        }
    } else {
        // Check if the client prefers dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            initialMode = 'dark'
        } else {
            initialMode = 'light'
        }
        localStorage.setItem(LOCAL_STORAGE_KEY, initialMode)
    }

    document.documentElement.dataset.mode = initialMode

    PetiteVue.createApp({
        'mode': initialMode,
        handleClick() {
            let currentMode = this.mode

            if (currentMode == 'light') {
                this.mode = 'dark'
            } else if (currentMode == 'dark') {
                this.mode = 'darkest'
            } else if (currentMode == 'darkest') {
                this.mode = 'light'
            }

            document.documentElement.dataset.mode = this.mode
            localStorage.setItem(LOCAL_STORAGE_KEY, this.mode)

            console.log(this.mode)
        }
    }).mount('#mode_toggle')
})()
</script>
            <p class="mobile_search_link">
                <a href="search.html" title="Search">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 65 64" fill-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M14.873 40.009c-2.315-3.943-3.642-8.532-3.642-13.429C11.231 11.91 23.141 0 37.811 0s26.58 11.91 26.58 26.58-11.91 26.58-26.58 26.58a26.44 26.44 0 0 1-14.277-4.161L9.739 62.794a3.12 3.12 0 0 1-4.413 0L.913 58.382c-1.217-1.218-1.217-3.196 0-4.413l13.96-13.96zM37.811 8.054c10.225 0 18.526 8.301 18.526 18.526s-8.301 18.526-18.526 18.526-18.526-8.301-18.526-18.526S27.586 8.054 37.811 8.054z" fill="#fff" />
                    </svg>
                </a>
            </p>
        

        <div class="searchbox_wrapper">
            
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
    </nav>
</div>

    
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper"><p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="User_Guide.html">Background Info</a></li>
<li class="toctree-l1"><a class="reference internal" href="FirstTimeStartUp.html">First Time Startup</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="addingelements.html">Adding Elements</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="AddingNewBLEMessage.html">Adding a New BLE Message</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewBoard.html">Adding a New Board</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewCanMotor.html">Adding a New CAN Motor</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewController.html">Adding a New Controller</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewErrorCase.html">Adding a New Error Case</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewItemToConfig.html">Adding New Item to Config</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewJoint.html">Adding a New Joint</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewMicrocontroller.html">Adding a New Microcontroller</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewMotorType.html">Adding a New Motor Type</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Adding New Sensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewUARTMessage.html">Adding New UART Messages</a></li>
<li class="toctree-l2"><a class="reference internal" href="AddingNewPages.html">Add Documentation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">OpenExo GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="gamification_template.html">Gamification Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="StyleGuide.html">OpenExo C++ Style Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="AddingNewPages.html">Add Documentation</a></li>
</ul>

        </div>
      </div>


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="adding-new-sensors">
<h1>Adding New Sensors<a class="headerlink" href="#adding-new-sensors" title="Link to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>In our codebase, sensor integration varies depending on the sensor. Below are examples of sensors that have been tested or integrated and are compatible with our platform:</p>
<ul class="simple">
<li><p><strong>Analog input</strong></p>
<ul>
<li><p>Force sensitive resistor</p></li>
<li><p>Torque sensor (strain gauge)</p></li>
<li><p>Angle sensor (AS5600; hall effect)</p></li>
</ul>
</li>
<li><p><strong>Bus protocol</strong></p>
<ul>
<li><p>I2C (Teensy-Nano communication)</p></li>
<li><p>UART (Teensy-Nano communication)</p></li>
<li><p>CAN (Teensy-Motor communication)</p></li>
<li><p>SPI (Teensy-SD Card interface)</p></li>
</ul>
</li>
</ul>
<p>Here, we demonstrate how the Teensy communicates with sensors using an example for an analog input sensor and another for the I2C protocol.
We also have a detailed example available as part of our <a class="reference external" href="https://wiki.theopenexo.org/app/page/1wFgeHE1jJ0RdbhfDIQUPjvBr5m3PwdyW?p=14AIGjap02Wv8jPJxyezvfYJYFVIJIoO1">wiki</a>.</p>
</section>
<hr class="docutils" />
<section id="analog-input">
<h2>Analog Input<a class="headerlink" href="#analog-input" title="Link to this heading">¶</a></h2>
<p>For an analog sensor—such as the torque sensor used for exoskeleton torque feedback control—the fundamental operation uses <code class="docutils literal notranslate"><span class="pre">analogRead()</span></code> on the sensor’s signal pin to retrieve its value (or an amplified version):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="n">current_reading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">analogRead</span><span class="p">(</span><span class="n">_pin</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">torque_calibration</span><span class="o">::</span><span class="n">AI_CNT_TO_V</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>Notes from PJRC:</strong></p>
<ul class="simple">
<li><p>None of the pins on the Teensy are 5-volt tolerant; the input voltage range is fixed at 0 to 3.3 volts.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">analogReference()</span></code> has no effect on the Teensy 4.1.</p></li>
</ul>
<p><em>Sidenote:</em>
If you need to use <code class="docutils literal notranslate"><span class="pre">digitalRead()</span></code>, ensure you set the proper pin mode using <code class="docutils literal notranslate"><span class="pre">pinMode()</span></code>, such as <code class="docutils literal notranslate"><span class="pre">INPUT</span></code> or <code class="docutils literal notranslate"><span class="pre">INPUT_PULLUP</span></code>. Refer to the sensor or peripheral user manual for guidance.</p>
<p><strong>More examples on ``analogRead()``:</strong>
The following files utilize <code class="docutils literal notranslate"><span class="pre">analogRead()</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">AnkleAngles.cpp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">FSR.cpp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">TorqueSensor.cpp</span></code></p></li>
</ul>
<p><strong>Available Analog Pins:</strong>
If you are using our reference PCB, consult the <a class="reference external" href="https://wiki.theopenexo.org/app/page/1IDIvK_TSzBucPz_MaAadYhhmePD3nf_bLp5UVSXbmy0?p=14AIGjap02Wv8jPJxyezvfYJYFVIJIoO1">PCB design documentation</a> for the list of available analog pins. Stacking headers for Teensy 4.1 can also be used to improve access.</p>
</section>
<hr class="docutils" />
<section id="bus-protocols">
<h2>Bus Protocols<a class="headerlink" href="#bus-protocols" title="Link to this heading">¶</a></h2>
<p>Unlike analog signals, bus protocols provide a highway for digital signals, enabling faster data transmission at higher frequencies.
A comparison of the protocols used in our codebase can be found here:
<a class="reference external" href="https://www.totalphase.com/blog/2021/12/i2c-vs-spi-vs-uart-introduction-and-comparison-similarities-differences/">I2C vs SPI vs UART</a></p>
<p><strong>I2C in Our Codebase—A Detailed Example</strong></p>
<p>Noah Enlow has put together excellent documentation on I2C in our codebase. Below is a step-by-step example of sending float data over I2C using a union.</p>
<p><strong>Sending Device</strong></p>
<ol class="arabic">
<li><p>Define the Union</p>
<p>This union allows you to access the same raw data as a float or as bytes.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">union</span><span class="w"> </span><span class="nc">Data</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">data_as_float</span><span class="p">;</span><span class="w">        </span><span class="c1">// Float representation</span>
<span class="w">    </span><span class="n">byte</span><span class="w"> </span><span class="n">data_as_bytes</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span><span class="w">      </span><span class="c1">// Byte vector (floats are 4 bytes)</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>Store the Data to Send</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Data</span><span class="p">.</span><span class="n">data_as_float</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_to_be_sent</span><span class="p">;</span>
</pre></div>
</div>
</li>
<li><p>Send Data via I2C Using the Wire Library</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">void</span><span class="w"> </span><span class="nf">sendEvent</span><span class="p">(){</span>
<span class="w">    </span><span class="n">Wire</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">data_as_bytes</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Data</span><span class="p">.</span><span class="n">data_as_bytes</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
<p><strong>Recieving Device</strong></p>
<blockquote>
<div><ol class="arabic">
<li><p>Define an identical union:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">union</span><span class="w"> </span><span class="nc">Data</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">data_as_float</span><span class="p">;</span>
<span class="w">    </span><span class="n">byte</span><span class="w"> </span><span class="n">data_as_bytes</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p>Request the data from the peripheral:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Wire</span><span class="p">.</span><span class="n">requestFrom</span><span class="p">(</span><span class="n">PERIPHERAL_ADDRESS</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Data</span><span class="p">.</span><span class="n">data_as_bytes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wire</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Convert the received bytes back to a float:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="n">data_received</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Data</span><span class="p">.</span><span class="n">data_as_float</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
</div></blockquote>
<p>In summary, the process is:</p>
<p>float -&gt; convert to bytes -&gt; send over I2C -&gt; receive as bytes -&gt; convert back to float</p>
<p><strong>More Examples on Bus Protocols:</strong></p>
<ul class="simple">
<li><p>Files using <strong>I2C</strong>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Battery.cpp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">I2CHandler.h</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RealTimeI2C.cpp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ThIMU.h</span></code></p></li>
</ul>
</li>
<li><p>Files using <strong>SPI</strong>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ParamsFromSD.cpp</span></code></p></li>
</ul>
</li>
<li><p>Files using <strong>UART</strong>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">ble_commands.h</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ComsMCU.cpp</span></code> and <code class="docutils literal notranslate"><span class="pre">ComsMCU.h</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ErrorReporter.h</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Exo.cpp</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uart_commands.h</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">UARTHandler.cpp</span></code></p></li>
</ul>
</li>
<li><p>Files using <strong>CAN</strong>:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">CAN.h</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Motor.cpp</span></code></p></li>
</ul>
</li>
</ul>
<p><strong>Available Pins for Bus Protocols:</strong>
Check your reference <a class="reference external" href="https://wiki.theopenexo.org/app/page/1IDIvK_TSzBucPz_MaAadYhhmePD3nf_bLp5UVSXbmy0?p=14AIGjap02Wv8jPJxyezvfYJYFVIJIoO1">PCB documentation</a> for the list of available pins. Stacking headers on the Teensy 4.1 can also improve access.</p>
</section>
<hr class="docutils" />
<section id="integrating-new-sensors-into-the-codebase">
<h2>Integrating New Sensors into the Codebase<a class="headerlink" href="#integrating-new-sensors-into-the-codebase" title="Link to this heading">¶</a></h2>
<p>To ensure that sensor readings are accessible across the system, follow these procedures to embed your new sensor.</p>
<p><strong>Location – Where Should I Write the Sensor Code?</strong>:
Due to the lack of a common sensor interface, decide where the sensor code best fits within the system architecture (e.g., exo, side, or joint level).</p>
<p><strong>Create the Sensor</strong>:
Develop a sensor as its own class by creating corresponding <code class="docutils literal notranslate"><span class="pre">.h</span></code> and <code class="docutils literal notranslate"><span class="pre">.cpp</span></code> files in the <strong>src</strong> folder. Below is an outline for the sensor header file:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">class</span><span class="w"> </span><span class="nc">CLASS_NAME</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// Constructor: may include a pin parameter if using an analog input</span>
<span class="w">        </span><span class="n">CLASS_NAME</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">pin</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Checks if the sensor needs calibration and returns whether calibration is complete</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nf">calibrate</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="n">do_calibrate</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Reads the sensor and returns its value; for multiple returns, use pointers</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="nf">read</span><span class="p">();</span>

<span class="w">    </span><span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="c1">// A sample private function (implementation will vary)</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="n">_sample_function</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// The pin to which the sensor is connected</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">_pin</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// A private variable for sensor data (example)</span>
<span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">_sample_var</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p><strong>Migrating to the Main Code</strong></p>
<p><strong>Board.h</strong>:
For each board that will use the sensor, define the pin(s) that each sensor will use. For analog sensors, define four pins if four sensors are employed (adapt for other types as needed). Ensure that the chosen pin is free; planning your PCB layout beforehand facilitates this.</p>
<p><strong>System Containing Sensor Data (.h)</strong>:
Create variables in the appropriate data-holding class (System; e.g., <code class="docutils literal notranslate"><span class="pre">SideData</span></code> or <code class="docutils literal notranslate"><span class="pre">JointData</span></code>) to store sensor readings and calibration status. For example:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">float</span><span class="w"> </span><span class="n">sensor_reading</span><span class="p">;</span>
<span class="kt">bool</span><span class="w"> </span><span class="n">sensor_calibrate</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>System Containing Sensor Data (.cpp)</strong>:
In the constructor for the corresponding data class, initialize these variables (often to 0 or false):</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">sensor_reading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="n">sensor_calibrate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>System Containing Sensor.h</strong>:
If the sensor is at the side level, include the sensor header in <code class="docutils literal notranslate"><span class="pre">Side.h</span></code>; if at the joint level, in <code class="docutils literal notranslate"><span class="pre">Joint.h</span></code>. Then, declare an instance of your sensor class:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Sensor.h&quot;</span>
<span class="c1">// Within the class declaration:</span>
<span class="n">SensorClass</span><span class="w"> </span><span class="n">new_instance_of_sensor</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>System Containing Sensor.cpp</strong>:
Within the corresponding <code class="docutils literal notranslate"><span class="pre">.cpp</span></code> file:</p>
<ol class="arabic">
<li><p>In the class constructor (using the initializer list), instantiate your sensor object. For example, for a joint level sensor:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">Joint</span><span class="o">::</span><span class="n">Joint</span><span class="p">(</span><span class="n">config_defs</span><span class="o">::</span><span class="n">joint_id</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">config_to_send</span><span class="p">)</span>
<span class="w">   </span><span class="o">:</span><span class="w"> </span><span class="n">motor</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">config_to_send</span><span class="p">)</span>
<span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="n">controller</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">config_to_send</span><span class="p">)</span>
<span class="w">   </span><span class="p">,</span><span class="w"> </span><span class="n">new_instance_of_sensor</span><span class="p">(</span><span class="n">pin_to_use</span><span class="p">)</span><span class="w">  </span><span class="c1">// Initialize the sensor instance</span>
<span class="p">{</span>
<span class="w">   </span><span class="c1">// Other initialization code...</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>In the method that reads sensor data, call the sensor’s <code class="docutils literal notranslate"><span class="pre">read()</span></code> function to update the system data:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">_joint_data</span><span class="o">-&gt;</span><span class="n">sensor_reading</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_instance_of_sensor</span><span class="p">.</span><span class="n">read</span><span class="p">();</span>
</pre></div>
</div>
</li>
<li><p>Similarly, call the sensor’s <code class="docutils literal notranslate"><span class="pre">calibrate()</span></code> method to update the calibration state:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">_joint_data</span><span class="o">-&gt;</span><span class="n">sensor_calibrate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_instance_of_sensor</span><span class="p">.</span><span class="n">calibrate</span><span class="p">(</span><span class="n">_joint_data</span><span class="o">-&gt;</span><span class="n">sensor_calibrate</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ol>
<p>This ensures that every time the joint (or side) runs, the sensor data is updated and, if needed, calibrated.</p>
<hr class="docutils" />
<p>By following the above steps, you can integrate new sensors into the system. Adjust the code examples as necessary to match the specific requirements of your sensor and target hardware.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
    
        <div id="show_right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&lt;</span><span>Page contents</span></a></p>
        </div>

        <div id="right_sidebar">
            <p><a class="toggle_right_sidebar" href="#"><span class="icon">&gt;</span><span>Page contents:</span></a></p>
            <div class="page_toc">
                <ul>
<li><a class="reference internal" href="#">Adding New Sensors</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#analog-input">Analog Input</a></li>
<li><a class="reference internal" href="#bus-protocols">Bus Protocols</a></li>
<li><a class="reference internal" href="#integrating-new-sensors-into-the-codebase">Integrating New Sensors into the Codebase</a></li>
</ul>
</li>
</ul>

            </div>
        </div>
    

      <div class="clearer"></div>
    </div>
    <div class="button_nav_wrapper">
        <div class="button_nav">
            <div class="left">
                
                <a href="AddingNewMotorType.html">
                    <span class="icon">&lt;</span><span>Adding a New Motor Type</span></a>
                
            </div>

            <div class="right">
                
                    <a href="AddingNewUARTMessage.html"><span>Adding New UART Messages</span><span class="icon">&gt;</span></a>
                
            </div>
        </div>
    </div>


    <div class="footer" role="contentinfo">
    &#169; Copyright 2025, Landon Coonrod, Jack Williams, and Prof. Zach Lerner.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    </div>

<p id="theme_credit">Styled using the <a href="https://github.com/piccolo-orm/piccolo_theme">Piccolo Theme</a></p>
  </body>
</html>