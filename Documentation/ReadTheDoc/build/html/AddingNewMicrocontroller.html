<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="lang:clipboard.copy" content="Copy to clipboard">
  <meta name="lang:clipboard.copied" content="Copied to clipboard">
  <meta name="lang:search.language" content="en">
  <meta name="lang:search.pipeline.stopwords" content="True">
  <meta name="lang:search.pipeline.trimmer" content="True">
  <meta name="lang:search.result.none" content="No matching documents">
  <meta name="lang:search.result.one" content="1 matching document">
  <meta name="lang:search.result.other" content="# matching documents">
  <meta name="lang:search.tokenizer" content="[\s\-]+">

  
    <link href="https://fonts.gstatic.com/" rel="preconnect" crossorigin>
    <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700|Roboto:300,400,400i,700&display=fallback" rel="stylesheet">

    <style>
      body,
      input {
        font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif
      }

      code,
      kbd,
      pre {
        font-family: "Roboto Mono", "Courier New", Courier, monospace
      }
    </style>
  

  <link rel="stylesheet" href="_static/stylesheets/application.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-palette.css"/>
  <link rel="stylesheet" href="_static/stylesheets/application-fixes.css"/>
  
  <link rel="stylesheet" href="_static/fonts/material-icons.css"/>
  
  <meta name="theme-color" content="#3f51b5">
  <script src="_static/javascripts/modernizr.js"></script>
  
  
  
    <title>Adding a New Microcontroller &#8212; OpenExo Documentation 0.1-dev documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=75810a84" />
    <link rel="stylesheet" type="text/css" href="_static/material.css?v=79c92029" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script src="_static/jquery.js?v=5d32c60e"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="_static/documentation_options.js?v=4f578d93"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Adding a New Motor Type" href="AddingNewMotorType.html" />
    <link rel="prev" title="Adding a New Joint" href="AddingNewJoint.html" />
  
   

  </head>
  <body dir=ltr
        data-md-color-primary=blue-grey data-md-color-accent=blue>
  
  <svg class="md-svg">
    <defs data-children-count="0">
      
      <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
      
    </defs>
  </svg>
  
  <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer">
  <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search">
  <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
  <a href="#AddingNewMicrocontroller" tabindex="1" class="md-skip"> Skip to content </a>
  <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex navheader">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="index.html" title="OpenExo Documentation 0.1-dev documentation"
           class="md-header-nav__button md-logo">
          
            &nbsp;
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          <span class="md-header-nav__topic">OpenExo Documentation 0.1-dev documentation</span>
          <span class="md-header-nav__topic"> Adding a New Microcontroller </span>
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
        
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" action="search.html" method="get" name="search">
      <input type="text" class="md-search__input" name="q" placeholder=""Search""
             autocapitalize="off" autocomplete="off" spellcheck="false"
             data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>

      </div>
      
      
  
  <script src="_static/javascripts/version_dropdown.js"></script>
  <script>
    var json_loc = ""versions.json"",
        target_loc = "../",
        text = "Versions";
    $( document ).ready( add_version_dropdown(json_loc, target_loc, text));
  </script>
  

    </div>
  </nav>
</header>

  
  <div class="md-container">
    
    
    
  <nav class="md-tabs" data-md-component="tabs">
    <div class="md-tabs__inner md-grid">
      <ul class="md-tabs__list">
          <li class="md-tabs__item"><a href="index.html" class="md-tabs__link">OpenExo Documentation 0.1-dev documentation</a></li>
          <li class="md-tabs__item"><a href="addingelements.html" class="md-tabs__link">Adding Elements</a></li>
      </ul>
    </div>
  </nav>
    <main class="md-main">
      <div class="md-main__inner md-grid" data-md-component="container">
        
          <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="index.html" title="OpenExo Documentation 0.1-dev documentation" class="md-nav__button md-logo">
      
        <img src="_static/" alt=" logo" width="48" height="48">
      
    </a>
    <a href="index.html"
       title="OpenExo Documentation 0.1-dev documentation">OpenExo Documentation 0.1-dev documentation</a>
  </label>
  

</nav>
              </div>
            </div>
          </div>
          <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
            <div class="md-sidebar__scrollwrap">
              <div class="md-sidebar__inner">
                
<nav class="md-nav md-nav--secondary">
    <label class="md-nav__title" for="__toc">"Contents"</label>
  <ul class="md-nav__list" data-md-scrollfix="">
        <li class="md-nav__item"><a href="#addingnewmicrocontroller--page-root" class="md-nav__link">Adding a New Microcontroller</a><nav class="md-nav">
              <ul class="md-nav__list">
        <li class="md-nav__item"><a href="#selecting-microcontroller" class="md-nav__link">Selecting Microcontroller</a>
        </li>
        <li class="md-nav__item"><a href="#design-board" class="md-nav__link">Design Board</a>
        </li>
        <li class="md-nav__item"><a href="#board-h" class="md-nav__link">Board.h</a>
        </li>
        <li class="md-nav__item"><a href="#config-ini" class="md-nav__link">config.ini</a>
        </li>
        <li class="md-nav__item"><a href="#parseini-h" class="md-nav__link">ParseIni.h</a>
        </li>
        <li class="md-nav__item"><a href="#other-files" class="md-nav__link">Other Files</a>
        </li></ul>
            </nav>
        </li>
    
<li class="md-nav__item"><a class="md-nav__extra_link" href="_sources/AddingNewMicrocontroller.rst.txt">Show Source</a> </li>

<li id="searchbox" class="md-nav__item"></li>

  </ul>
</nav>
              </div>
            </div>
          </div>
        
        <div class="md-content">
          <article class="md-content__inner md-typeset" role="main">
            
  <section id="adding-a-new-microcontroller">
<h1 id="addingnewmicrocontroller--page-root">Adding a New Microcontroller<a class="headerlink" href="#addingnewmicrocontroller--page-root" title="Link to this heading"></a></h1>
<p>This file assumes you are still using Arduino. If you are moving away from Arduino, you will need to remove Arduino-specific items (e.g., <code class="docutils literal notranslate"><span class="pre">logger::prints</span></code>, pin definitions using <code class="docutils literal notranslate"><span class="pre">A#</span></code>, etc.). Most of the code should run with little modification, but some reformatting may be necessary. If you are migrating away from Arduino, it is assumed that you have sufficient knowledge to handle those changes without further direction.</p>
<section id="selecting-microcontroller">
<h2 id="selecting-microcontroller">Selecting Microcontroller<a class="headerlink" href="#selecting-microcontroller" title="Link to this heading"></a></h2>
<p>You should confirm that the microcontroller includes the required elements. As of 20220517, these include:</p>
<p><strong>Controller:</strong>
- SPI
- CAN
- 8 Analog Inputs
- 9 Digital outputs</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Ideally with 3 PWM outputs for LED</em></p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>2 Digital inputs</p></li>
<li><p>Floating Point Unit</p></li>
</ul>
<p><strong>Coms:</strong>
- I2C
- SPI
- Bluetooth Low Energy</p>
<p><strong>IMU:</strong>
- Floating Point Unit</p>
<p>It is also advisable to check that there are existing Arduino libraries for the modules, ideally with identical interfaces. Note that the SPI peripheral in slave mode can be particularly challenging, as most SPI libraries assume the microcontroller is the controller (master).</p>
</section>
<section id="design-board">
<h2 id="design-board">Design Board<a class="headerlink" href="#design-board" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>When designing the board, start from the current board as a template.</p></li>
<li><p>In the schematic, place components close to where they are needed on the board—this is particularly important for capacitors and resistors, where proximity matters.</p></li>
<li><p>For the board layout file, ensure those capacitors and resistors are placed correctly.</p></li>
<li><p>For the CAN bus, place a restriction (or shield) above the traces to prevent capacitive coupling on the lines.</p></li>
</ul>
</section>
<section id="board-h">
<h2 id="board-h">Board.h<a class="headerlink" href="#board-h" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Create a new <code class="docutils literal notranslate"><span class="pre">#define</span></code> for your board, where you define both the board’s name and an associated number.</p></li>
<li><p>Create a new <code class="docutils literal notranslate"><span class="pre">#elif</span></code> for the new board, defining the pins for your board.
- Add a preprocessor condition such as <code class="docutils literal notranslate"><span class="pre">#if</span> <span class="pre">defined([Microcontroller])</span></code> so you can use pin names like <code class="docutils literal notranslate"><span class="pre">A19</span></code> without compiling errors when building for a different board.</p></li>
<li><p>Assign the pins based on your board design—use existing boards as a template.</p></li>
</ol>
</section>
<section id="config-ini">
<h2 id="config-ini">config.ini<a class="headerlink" href="#config-ini" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>Add your board and its version to the file.</p></li>
</ol>
</section>
<section id="parseini-h">
<h2 id="parseini-h">ParseIni.h<a class="headerlink" href="#parseini-h" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>In the <code class="docutils literal notranslate"><span class="pre">config_defs</span></code> namespace, add your board name and board version.</p></li>
<li><p>For the controller board, ensure that the <code class="docutils literal notranslate"><span class="pre">std::map</span></code> is available.</p></li>
<li><p>In the <code class="docutils literal notranslate"><span class="pre">config_map</span></code> namespace, add the mapping for your board and version.</p></li>
</ol>
</section>
<section id="other-files">
<h2 id="other-files">Other Files<a class="headerlink" href="#other-files" title="Link to this heading"></a></h2>
<p>This section gets more involved. You will need to update multiple files with preprocessor directives and specific includes to ensure that the code compiles correctly for your microcontroller.</p>
<ol class="arabic">
<li><p><strong>Preprocessor Defines:</strong>
Go through each file and add preprocessor defines around the areas that should compile for your microcontroller.
- For the <strong>controller micro</strong>, add your micro in a condition similar to:</p>
<blockquote>
<div><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(ARDUINO_TEENSY36) || defined(ARDUINO_TEENSY41)</span>
</pre></div>
</div>
</div></blockquote>
<ul>
<li><p>For the <strong>coms micro</strong>, add your micro in a condition like:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#if defined(ARDUINO_ARDUINO_NANO33BLE)</span>
</pre></div>
</div>
</li>
<li><p>In some cases, you may need to add specific includes (for example, include SPI in <code class="docutils literal notranslate"><span class="pre">ExoCode.ino</span></code>).</p></li>
</ul>
</li>
<li><p><strong>Determining the Correct Microcontroller Name for Defines:</strong>
- Navigate to your Arduino directory: <code class="docutils literal notranslate"><span class="pre">arduino/hardware/[type]/boards.txt</span></code>.
- Locate your microcontroller and look for an entry like <code class="docutils literal notranslate"><span class="pre">*.board.name=[name]</span></code>.
- In your define, prepend the obtained board name with <code class="docutils literal notranslate"><span class="pre">ARDUINO_</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p>For example, if the board name is <code class="docutils literal notranslate"><span class="pre">TEENSY41</span></code> (for Teensy 4.1), then you will use <code class="docutils literal notranslate"><span class="pre">ARDUINO_TEENSY41</span></code>.</p></li>
<li><p>Note: The Nano 33 appears as <code class="docutils literal notranslate"><span class="pre">ARDUINO_NANO33BLE</span></code>, so the corresponding define will be <code class="docutils literal notranslate"><span class="pre">ARDUINO_ARDUINO_NANO33BLE</span></code>.
<strong>Be careful</strong> to follow the naming conventions exactly to ensure consistency.</p></li>
</ul>
</div></blockquote>
</li>
</ol>
</section>
</section>


          </article>
        </div>
      </div>
    </main>
  </div>
  <footer class="md-footer">
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
          
            <a href="AddingNewJoint.html" title="Adding a New Joint"
               class="md-flex md-footer-nav__link md-footer-nav__link--prev"
               rel="prev">
              <div class="md-flex__cell md-flex__cell--shrink">
                <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
              </div>
              <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
                <span class="md-flex__ellipsis">
                  <span
                      class="md-footer-nav__direction"> "Previous" </span> Adding a New Joint </span>
              </div>
            </a>
          
          
            <a href="AddingNewMotorType.html" title="Adding a New Motor Type"
               class="md-flex md-footer-nav__link md-footer-nav__link--next"
               rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span
                class="md-flex__ellipsis"> <span
                class="md-footer-nav__direction"> "Next" </span> Adding a New Motor Type </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink"><i
                class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          
        </a>
        
      </nav>
    </div>
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-footer-copyright">
          <div class="md-footer-copyright__highlight">
              &#169; Copyright 2025, Landon Coonrod, Jack Williams, and Prof. Zach Lerner.
              
          </div>
            Created using
            <a href="http://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
             and
            <a href="https://github.com/bashtage/sphinx-material/">Material for
              Sphinx</a>
        </div>
      </div>
    </div>
  </footer>
  <script src="_static/javascripts/application.js"></script>
  <script>app.initialize({version: "1.0.4", url: {base: ".."}})</script>
  </body>
</html>